{$this->max = ['system'=>-1, 'user'=>-1, 'memory'=>-1];}
{$this->sum = ['system'=>0, 'user'=>0, 'memory'=>0];}
{$this->count = 0;}
{$perf = iterator_to_array($this->input->getPerf());}

{foreach ($perf as $r)}
	{if ("hhvm-" != substr($r['version'], 0, 5) && $r['exit_sum']==0)}
		{$hasSuccess = true;}
	{/}
{/}

{foreach ($perf as $r)}
	{if ("hhvm-" == substr($r['version'], 0, 5) || ($hasSuccess && $r['exit_sum']>0))}
		{continue;}
	{/}

	{$this->count++;}
	{$this->max['system'] = max($this->max['system'], $r['system']);}
	{$this->max['user']   = max($this->max['user'],   $r['user']);}
	{$this->max['memory'] = max($this->max['memory'], $r['memory']);}
	{$this->sum['system'] += $r['system'];}
	{$this->sum['user']   += $r['user'];}
	{$this->sum['memory'] += $r['memory'];}
{/}

{if ($this->count == 0)}
	No results found
	{return;}
{/}

{$this->avg = [
	'system' => round($this->sum['system'] / $this->count, 3),
	'user'   => round($this->sum['user']   / $this->count, 3),
	'memory' => round($this->sum['memory'] / $this->count, 3),
];}

<script>
	var perfAggregates = {
		system: { max: {max['system']}, low: {avg['system']}, high: {print ($this->max['system'] + $this->avg['system']) / 2;}},
		user: { max: {max['user']}, low: {avg['user']}, high: {print ($this->max['user'] + $this->avg['user']) / 2;}},
		memory: { max: {max['memory']}, low: {avg['memory']}, high: {print ($this->max['memory'] + $this->avg['memory']) / 2;}}
	};
</script>

<table>
	<thead>
		<tr>
			<th>Version</th>
			<th>System time (s)</th>
			<th>User time (s)</th>
			<th>Memory (MiB)</th>
		</tr>
	</thead>

	<tbody>
		{foreach ($perf as $this->r)}
			<tr{if ($this->r['exit_sum']>0)} data-unsuccessful="1"{/}>
				<td>{r['version']}</td>
				<td>{r['system']}</td>
				<td>{r['user']}</td>
				<td>{r['memory']}</td>
			</tr>
		{/}
	</tbody>
</table>
